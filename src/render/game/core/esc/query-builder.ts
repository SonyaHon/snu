import { Component } from "./component";
import { Entity } from "./entity";
import { Constructor, fetchComponentId } from "./utils";
import { World } from "./world";

export enum QType {
    Include = "include",
    Exclude = "exclude",
    Optionally = "optionally",
    Entity = "entity",
}

export type QueryOptionInclude<T> = {
    type: "include",
    data: Constructor<T>
}
export type QueryOptionExclude<T> = {
    type: "exclude",
    data: Constructor<T>
}
export type QueryOptionOptionally<T> = {
    type: "optionally",
    data: Constructor<T>
}
export type QueryOptionWithEntity = {
    type: "entity",
}
export type FilterUndefined<T extends unknown[]> = T extends [] ? [] :
    T extends [infer H, ...infer R] ?
    H extends undefined ? FilterUndefined<R> : [H, ...FilterUndefined<R>] : T;

export type QueryOption<T> = QueryOptionInclude<T> | QueryOptionExclude<T> | QueryOptionOptionally<T> | QueryOptionWithEntity;
export type QueryResult<T> = T extends QueryOptionInclude<infer R> ? R : (
    T extends QueryOptionOptionally<infer R> ? (R | null) : (
        T extends QueryOptionWithEntity ? Entity : undefined));

export const Include = <T extends Component>(component: Constructor<T>): QueryOptionInclude<T> => {
    return {
        type: QType.Include,
        data: component
    }
};

export const Exclude = <T extends Component>(component: Constructor<T>): QueryOptionExclude<T> => {
    return {
        type: QType.Exclude,
        data: component,
    }
}

export const Optionally = <T extends Component>(component: Constructor<T>): QueryOptionOptionally<T> => {
    return {
        type: QType.Optionally,
        data: component,
    }
}

export const WithEntity = (): QueryOptionWithEntity => {
    return {
        type: QType.Entity,
    }
}

export class QueryBuilder {
    constructor(private readonly world: World) { }

    run<T0 extends Component, M0 extends QueryOption<T0>>(a0: M0): FilterUndefined<[QueryResult<M0>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>>(a0: M0, a1: M1): FilterUndefined<[QueryResult<M0>, QueryResult<M1>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>>(a0: M0, a1: M1, a2: M2): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>>(a0: M0, a1: M1, a2: M2, a3: M3): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>, T20 extends Component, M20 extends QueryOption<T20>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19, a20: M20): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>, QueryResult<M20>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>, T20 extends Component, M20 extends QueryOption<T20>, T21 extends Component, M21 extends QueryOption<T21>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19, a20: M20, a21: M21): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>, QueryResult<M20>, QueryResult<M21>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>, T20 extends Component, M20 extends QueryOption<T20>, T21 extends Component, M21 extends QueryOption<T21>, T22 extends Component, M22 extends QueryOption<T22>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19, a20: M20, a21: M21, a22: M22): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>, QueryResult<M20>, QueryResult<M21>, QueryResult<M22>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>, T20 extends Component, M20 extends QueryOption<T20>, T21 extends Component, M21 extends QueryOption<T21>, T22 extends Component, M22 extends QueryOption<T22>, T23 extends Component, M23 extends QueryOption<T23>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19, a20: M20, a21: M21, a22: M22, a23: M23): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>, QueryResult<M20>, QueryResult<M21>, QueryResult<M22>, QueryResult<M23>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>, T20 extends Component, M20 extends QueryOption<T20>, T21 extends Component, M21 extends QueryOption<T21>, T22 extends Component, M22 extends QueryOption<T22>, T23 extends Component, M23 extends QueryOption<T23>, T24 extends Component, M24 extends QueryOption<T24>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19, a20: M20, a21: M21, a22: M22, a23: M23, a24: M24): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>, QueryResult<M20>, QueryResult<M21>, QueryResult<M22>, QueryResult<M23>, QueryResult<M24>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>, T20 extends Component, M20 extends QueryOption<T20>, T21 extends Component, M21 extends QueryOption<T21>, T22 extends Component, M22 extends QueryOption<T22>, T23 extends Component, M23 extends QueryOption<T23>, T24 extends Component, M24 extends QueryOption<T24>, T25 extends Component, M25 extends QueryOption<T25>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19, a20: M20, a21: M21, a22: M22, a23: M23, a24: M24, a25: M25): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>, QueryResult<M20>, QueryResult<M21>, QueryResult<M22>, QueryResult<M23>, QueryResult<M24>, QueryResult<M25>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>, T20 extends Component, M20 extends QueryOption<T20>, T21 extends Component, M21 extends QueryOption<T21>, T22 extends Component, M22 extends QueryOption<T22>, T23 extends Component, M23 extends QueryOption<T23>, T24 extends Component, M24 extends QueryOption<T24>, T25 extends Component, M25 extends QueryOption<T25>, T26 extends Component, M26 extends QueryOption<T26>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19, a20: M20, a21: M21, a22: M22, a23: M23, a24: M24, a25: M25, a26: M26): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>, QueryResult<M20>, QueryResult<M21>, QueryResult<M22>, QueryResult<M23>, QueryResult<M24>, QueryResult<M25>, QueryResult<M26>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>, T20 extends Component, M20 extends QueryOption<T20>, T21 extends Component, M21 extends QueryOption<T21>, T22 extends Component, M22 extends QueryOption<T22>, T23 extends Component, M23 extends QueryOption<T23>, T24 extends Component, M24 extends QueryOption<T24>, T25 extends Component, M25 extends QueryOption<T25>, T26 extends Component, M26 extends QueryOption<T26>, T27 extends Component, M27 extends QueryOption<T27>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19, a20: M20, a21: M21, a22: M22, a23: M23, a24: M24, a25: M25, a26: M26, a27: M27): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>, QueryResult<M20>, QueryResult<M21>, QueryResult<M22>, QueryResult<M23>, QueryResult<M24>, QueryResult<M25>, QueryResult<M26>, QueryResult<M27>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>, T20 extends Component, M20 extends QueryOption<T20>, T21 extends Component, M21 extends QueryOption<T21>, T22 extends Component, M22 extends QueryOption<T22>, T23 extends Component, M23 extends QueryOption<T23>, T24 extends Component, M24 extends QueryOption<T24>, T25 extends Component, M25 extends QueryOption<T25>, T26 extends Component, M26 extends QueryOption<T26>, T27 extends Component, M27 extends QueryOption<T27>, T28 extends Component, M28 extends QueryOption<T28>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19, a20: M20, a21: M21, a22: M22, a23: M23, a24: M24, a25: M25, a26: M26, a27: M27, a28: M28): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>, QueryResult<M20>, QueryResult<M21>, QueryResult<M22>, QueryResult<M23>, QueryResult<M24>, QueryResult<M25>, QueryResult<M26>, QueryResult<M27>, QueryResult<M28>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>, T20 extends Component, M20 extends QueryOption<T20>, T21 extends Component, M21 extends QueryOption<T21>, T22 extends Component, M22 extends QueryOption<T22>, T23 extends Component, M23 extends QueryOption<T23>, T24 extends Component, M24 extends QueryOption<T24>, T25 extends Component, M25 extends QueryOption<T25>, T26 extends Component, M26 extends QueryOption<T26>, T27 extends Component, M27 extends QueryOption<T27>, T28 extends Component, M28 extends QueryOption<T28>, T29 extends Component, M29 extends QueryOption<T29>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19, a20: M20, a21: M21, a22: M22, a23: M23, a24: M24, a25: M25, a26: M26, a27: M27, a28: M28, a29: M29): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>, QueryResult<M20>, QueryResult<M21>, QueryResult<M22>, QueryResult<M23>, QueryResult<M24>, QueryResult<M25>, QueryResult<M26>, QueryResult<M27>, QueryResult<M28>, QueryResult<M29>]>[];
    run<T0 extends Component, M0 extends QueryOption<T0>, T1 extends Component, M1 extends QueryOption<T1>, T2 extends Component, M2 extends QueryOption<T2>, T3 extends Component, M3 extends QueryOption<T3>, T4 extends Component, M4 extends QueryOption<T4>, T5 extends Component, M5 extends QueryOption<T5>, T6 extends Component, M6 extends QueryOption<T6>, T7 extends Component, M7 extends QueryOption<T7>, T8 extends Component, M8 extends QueryOption<T8>, T9 extends Component, M9 extends QueryOption<T9>, T10 extends Component, M10 extends QueryOption<T10>, T11 extends Component, M11 extends QueryOption<T11>, T12 extends Component, M12 extends QueryOption<T12>, T13 extends Component, M13 extends QueryOption<T13>, T14 extends Component, M14 extends QueryOption<T14>, T15 extends Component, M15 extends QueryOption<T15>, T16 extends Component, M16 extends QueryOption<T16>, T17 extends Component, M17 extends QueryOption<T17>, T18 extends Component, M18 extends QueryOption<T18>, T19 extends Component, M19 extends QueryOption<T19>, T20 extends Component, M20 extends QueryOption<T20>, T21 extends Component, M21 extends QueryOption<T21>, T22 extends Component, M22 extends QueryOption<T22>, T23 extends Component, M23 extends QueryOption<T23>, T24 extends Component, M24 extends QueryOption<T24>, T25 extends Component, M25 extends QueryOption<T25>, T26 extends Component, M26 extends QueryOption<T26>, T27 extends Component, M27 extends QueryOption<T27>, T28 extends Component, M28 extends QueryOption<T28>, T29 extends Component, M29 extends QueryOption<T29>, T30 extends Component, M30 extends QueryOption<T30>>(a0: M0, a1: M1, a2: M2, a3: M3, a4: M4, a5: M5, a6: M6, a7: M7, a8: M8, a9: M9, a10: M10, a11: M11, a12: M12, a13: M13, a14: M14, a15: M15, a16: M16, a17: M17, a18: M18, a19: M19, a20: M20, a21: M21, a22: M22, a23: M23, a24: M24, a25: M25, a26: M26, a27: M27, a28: M28, a29: M29, a30: M30): FilterUndefined<[QueryResult<M0>, QueryResult<M1>, QueryResult<M2>, QueryResult<M3>, QueryResult<M4>, QueryResult<M5>, QueryResult<M6>, QueryResult<M7>, QueryResult<M8>, QueryResult<M9>, QueryResult<M10>, QueryResult<M11>, QueryResult<M12>, QueryResult<M13>, QueryResult<M14>, QueryResult<M15>, QueryResult<M16>, QueryResult<M17>, QueryResult<M18>, QueryResult<M19>, QueryResult<M20>, QueryResult<M21>, QueryResult<M22>, QueryResult<M23>, QueryResult<M24>, QueryResult<M25>, QueryResult<M26>, QueryResult<M27>, QueryResult<M28>, QueryResult<M29>, QueryResult<M30>]>[];
    run<T0 extends Component>(...args: (QueryOptionInclude<T0> | QueryOptionExclude<T0> | QueryOptionOptionally<T0> | QueryOptionWithEntity)[]): (QueryResult<QueryOptionInclude<T0>> | QueryResult<QueryOptionExclude<T0>> | QueryResult<QueryOptionOptionally<T0>> | QueryResult<QueryOptionWithEntity>)[][] {
        const result: any[][] = [];
        const excludes = args.filter(opt => opt.type === "exclude").map(el => fetchComponentId((el as QueryOptionExclude<T0>).data));
        const { entities, components } = this.world.getStorage();
        entities.forEach(entity => {
            const entry: (Component | Entity)[] = [];
            if (excludes.some(exComponent => {
                return !!components[exComponent][entity];
            })) {
                return;
            }
            for (let option of args) {
                switch (option.type) {
                    case "entity":
                        entry.push(new Entity(entity));
                        break;
                    case "optionally":
                        entry.push(components[fetchComponentId((option as QueryOptionOptionally<T0>).data)][entity] || null);
                        break;
                    case "exclude":
                        continue;
                    case "include":
                        const componentData = components[fetchComponentId((option as QueryOptionInclude<T0>).data)][entity];
                        if (!componentData) return;
                        entry.push(componentData);
                }
            }
            result.push(entry);
        });

        return result;
    }
}


// // Example
// const world = new World();
// class Position extends Component { }
// class Velocity extends Component { }
// class Acceleration extends Component { }
// class Player extends Component { }

// // Should be [Velocity, Acceleration | null][]
// const [pos, vel, acc] = world.buildQuery().run(
//     QueryBuilder.Include(Position),
//     QueryBuilder.Optionally(Velocity),
//     QueryBuilder.Exclude(Player),
//     QueryBuilder.Optionally(Acceleration)
// )[0];


